// SPDX-License-Identifier: UNLICENSED
pragma solidity ^0.8.13;

import "forge-std/Test.sol";
import "src/GitHubRegistry.sol";

contract CounterTest is Test {
    GitHubRegistry public githubRegistry;

    function setUp() public {
        githubRegistry = new GitHubRegistry();
    }

    function test_getSVG() public {
        bytes
            memory response = hex"00000000000000000000000000000000000000000000000000000000000000205ed8de79b8920ed9cc7e6a25301a39d400000000000000000000000000000000b8e2054f8a912367e38a22ce773328ff000000000000000000000000000000007369736d6f2d636f6e6e6563742d76312e31000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000e00000000000000000000000000000000000000000000000000000000000000020000000000000000000000000061060a65146b3265c62fc8f3ae977c9b27260ff0000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000001a068796472612d73332e310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001c000000000000000000000000000000000000000000000000000000000000004a000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000100100000000000000000000000000009999037000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002c0291a62bebc308475fba446f6f46fb60df1d31ef060e174fa88b48fed7ab1ad5d26f68802a0dbfe18fadf9c42aabac92812b98e7b176dfe75b699c4c5c350e0f4183454c902c5c25f2d42f208bbac3f809bb4c5df02fa9988e45e28ee24b2a8a41b3bd380b4735a43fce96a56e2b36a57ee4577242d823f8120cec935a3d3c51c02f80a9ee170d672223425616a824ad972d73eddfd909ed7339141b8c8bb77900f7df82e59b7d96b962561eecf0eb7d29a978f53ab97a51b042a55c39b46128b1f2d5b60b420c9994a08d8e24d60d15f9ffa4f535e10ebb3b676c6e06f0807811070196e2312dbfa40ee080ccc38874eba7cede6e17c69c1b4d2093d3597e1350000000000000000000000001001000000000000000000000000000099990370214649c394fbf6e29bf4e81a343902ccc2f24ba2f2b04a2a3277ca2f7b5aa4091801b584700a740f9576cc7e83745895452edc518a9ce60b430e1272fc4eb93b057cf80de4f8dd3e4c56f948f40c28c3acbeca71ef9f825597bf8cc059f1238b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001900a61466215a2356ff81e19b4630814adaa33966eac5b679f5d0a7abdfef052d372e04ae58cd6315fd8d389f38238d0b9b0ef4cde557d5b50cd413a3a4e5a7000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000";

        // register github id
        githubRegistry.register(
            response,
            0x061060a65146b3265C62fC8f3AE977c9B27260fF
        );

        // web3 function calls
        uint256[] memory ids = new uint256[](1);
        ids[0] = 0x99990370;
        string[] memory githubHandles = new string[](1);
        githubHandles[0] = "myhandle";

        vm.prank(githubRegistry.owner());
        githubRegistry.computeNFTs(ids, githubHandles);

        githubHandles[0] = "other";
        vm.prank(githubRegistry.owner());
        githubRegistry.computeNFTs(ids, githubHandles);

        string memory svg = githubRegistry.tokenURI(0x99990370);

        console.log(svg);
        assertEq(
            githubRegistry.ownerOf(0x99990370),
            0x061060a65146b3265C62fC8f3AE977c9B27260fF
        );
    }
}
